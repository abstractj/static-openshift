<!doctype html>
<html class="no-js" lang="en">
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

      <title>AeroGear - AeroGear iOS API Cookbook</title>
      <meta name="description" content="">
      <meta name="author" content="">

      <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0;">

      <link rel="shortcut icon" href="/favicon.ico" />
      <link rel="alternate" type="application/atom+xml" title="feed" href="/feed.atom"/>
      <link rel="stylesheet" href="/css/font-awesome.min.css">
      <link rel="stylesheet" href="/css/style.css">
      <link href='http://fonts.googleapis.com/css?family=Open+Sans:600,300,300italic,600italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>

      <script src="/js/libs/modernizr-2.6.2.min.js"></script>
		  <script type="text/javascript">

			  var _gaq = _gaq || [];
			  _gaq.push(['_setAccount', 'UA-28733717-2']);
			  _gaq.push(['_setDomainName', 'aerogear.org']);
			  _gaq.push(['_trackPageview']);

			  (function() {
				  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
					  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			  })();

		  </script>
      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
      <script>window.jQuery || document.write( '<script src="/js/libs/jquery-1.7.2.min.js"><\/script>' )</script>
  </head>
  <body>
      <header>
          <div class="wrapper">
              <a href="/"><div id="logo"></div></a>
              <a href="/news/2013/03/28/aerogear-1.0.0-is-out/index.html" class="news fixed">Hey listen!<br class="title-break"> AeroGear 1.0.0 is out!</a>
          </div>
      </header>
         
      <nav>
          <div class="wrapper">
            <div class="links">
                <a href="/" class="fixed">Home</a>
                <a href="/download" class="">Get started</a>
                <a href="/docs" class="">Documentation</a>
                <a href="/news" class="fixed ">News</a>
                <a href="/community" class="">Community</a>        
            </div>
            <a href="https://www.facebook.com/AeroGearProject"><div class="social facebook"></div></a>
            <a href="https://plus.google.com/106588661437153585722/posts"><div class="social google-plus"></div></a>
            <a href="https://www.twitter.com/aerogears"><div class="social twitter"></div></a>
          </div>    
          <div class="clearfix"></div>
      </nav>

      <div class="wrapper inner-container">

          <div class="basic">
    
<div class="sect1">
  <h2 id="_aerogear_ios_api_cookbook">AeroGear iOS API Cookbook</h2>
  
  <div class="sectionbody">
<div class="paragraph">
    
  <p>The goal of this guide is to introduce you to the current available <a href="http://aerogear.org/docs/specs/aerogear-ios/">iOS API</a> by using code examples to help you get started quickly. In particular we cover the following areas:</p>
</div>
<div class="ulist">
  
  <ul>
  
    <li>
      <p><a href="#pipe">HTTP REST abstraction</a> + <a href="#paging">Paging</a></p>
      
    </li>
  
    <li>
      <p><a href="#store">Store and DataManager</a></p>
      
    </li>
  
    <li>
      <p><a href="#auth">Authentication and User enrollment</a></p>
      
    </li>
  
  </ul>
</div>

  </div>
  
</div>


<div class="sect1">
  <h2 id="__a_id_pipe_a_pipe_and_pipeline"><a id="pipe"></a>Pipe and Pipeline</h2>
  
  <div class="sectionbody">
<div class="paragraph">
    
  <p>A Pipe object represents a server connection. An object of this class is responsible to communicate with the server in order to perform read/write operations.</p>
</div>
<div class="paragraph">
    
  <p>A Pipeline object represents a <em>collection</em> of server connections (aka Pipes). It provides a standard way to communicate with the server no matter the data format or transport expected. It contains some simple management APIs to create and remove Pipe objects.</p>
</div>

<div class="sect2">
  <h3 id="_creating_a_pipeline_and_a_pipe_object">Creating a pipeline and a pipe object</h3>
  
<div class="paragraph">
    
  <p>To create a pipeline, you need to use the AGPipeline class. Below is an example:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// NSURL object:
NSURL* serverURL = [NSURL URLWithString:@"http://todo-aerogear.rhcloud.com/todo-server/"];

// create the 'todo' pipeline, which points to the baseURL of the REST application
AGPipeline* todo = [AGPipeline pipelineWithBaseURL:serverURL];

// Add a REST pipe for the 'projects' endpoint
id&lt;AGPipe&gt; projects = [todo pipe:^(id&lt;AGPipeConfig&gt; config) {
    [config setName:@"projects"];
     // this is the default, can be emitted
    [config setType:@"REST"];
}];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>In the example above the <em>projects</em> pipe points to an RESTful endpoint (<a href="http://todo-aerogear.rhcloud.com/todo-server/projects">http://todo-aerogear.rhcloud.com/todo-server/projects</a>). However, technical details like RESTful APIs (e.g. HTTP PUT) are not exposed on the AGPipeline and AGPipe APIs. Below is shown how to get access to an actual pipe, from the AGPipeline object:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// get access to the 'projects' pipe
id&lt;AGPipe&gt; projects = [todo pipeWithName:@"projects"];</code></pre>
    
  </div>
</div>

  
</div>


<div class="sect2">
  <h3 id="_read_a_specific_object">Read a specific object</h3>
  
<div class="paragraph">
    
  <p>The <em>read:id</em> method allows you to fetch the object previously saved. The <a href="#noteid">id</a> of the object is used as the parameter.</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// read an object with id of 1
[projects read:@"1" success:^(id responseObject) {
    // LOG the JSON response, returned from the server:
    NSLog(@"READ RESPONSE\n%@", [responseObject description]);
} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"Read: An error occured! \n%@", error);
}];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>In this case, where we have a RESTful pipe the API issues a HTTP GET request.</p>
</div>

  
</div>


<div class="sect2">
  <h3 id="_read_all_objects_from_the_server">Read all objects from the server</h3>
  
<div class="paragraph">
    
  <p>The <em>read</em> method allows to (currently) read <em>all</em> object from the server, of the underlying AGPipe:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">[projects read:^(id responseObject) {
    // LOG the JSON response, returned from the server:
    NSLog(@"READ RESPONSE\n%@", [responseObject description]);
} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"Read: An error occured! \n%@", error);
}];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>Since we are pointing to a RESTful endpoint, the API issues a HTTP GET request.</p>
</div>

  
</div>


<div class="sect2">
  <h3 id="_save_object">Save object</h3>
  
<div class="paragraph">
    
  <p>The AGPipe offers an API to store objects on a <em>remote</em> server resource. <strong>Currently</strong> the objects are <em>just</em> simple map objects. In the future we are looking to support more advanced (complex) frameworks, like Core Data. The <em>save</em> method is described below:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// create a dictionary and set some key/value data on it:
NSMutableDictionary* projectEntity = [NSMutableDictionary dictionary];
[projectEntity setValue:@"Hello World" forKey:@"title"];
// add other properties, like style etc ...

// save the 'new' project:
[projects save:projectEntity success:^(id responseObject) {
    // LOG the JSON response, returned from the server:
    NSLog(@"CREATE RESPONSE\n%@", [responseObject description]);

    // get the id of the new project, from the JSON response...
    id resourceId = [responseObject valueForKey:@"id"];

    // and update the 'object', so that it knows its ID...
    [projectEntity setValue:[resourceId stringValue] forKey:@"id"];

} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"SAVE: An error occured! \n%@", error);
}];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>Above the <em>save</em> function stores the given NSDictionary on the server. In this case, where we have a RESTful pipe the API issues a HTTP POST request.</p>
</div>
<div id="noteid" class="admonitionblock">
  <table>
    <tr>
      <td class="icon">
        
        <div class="title">Note</div>
        
      </td>
      <td class="content">
        
        Upon success, we set the <a href="http://aerogear.org/docs/specs/aerogear-ios/Protocols/AGPipeConfig.html#//api/name/recordId">recordId</a> property on the object from the server response. This is a required step cause this property is used by Pipe&#8217;s <a href="#update">update</a> and <a href="#remove">remove</a> methods to perform operations on the object. By default, the <a href="http://aerogear.org/docs/specs/aerogear-ios/Protocols/AGPipe.html">Pipe</a> is configured to use the name <em>"id"</em>, but if your RESTful resource uses a different name, you can easily override it using the <a href="http://aerogear.org/docs/specs/aerogear-ios/Protocols/AGPipeConfig.html#//api/name/recordId">recordId</a> configuration option when constructing the <a href="http://aerogear.org/docs/specs/aerogear-ios/Protocols/AGPipe.html">Pipe</a>.

      </td>
    </tr>
  </table>
</div>

  
</div>


<div class="sect2">
  <h3 id="update">Update object</h3>
  
<div class="paragraph">
    
  <p>The <em>save</em> method is also responsible for updating an <em>object</em>. Before performing <em>save</em>, ensure that the object you are trying to save, has the <a href="#noteid">recordId</a> property set.</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// change the title of the previous project 'object':
[projectEntity setValue:@"Hello Update World!" forKey:@"title"];

// and now update it on the server
[projects save:projectEntity success:^(id responseObject) {
    // LOG the JSON response, returned from the server:
    NSLog(@"UPDATE RESPONSE\n%@", [responseObject description]);
} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"UPDATE: An error occured! \n%@", error);
}];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>In this case, where we have a RESTful pipe the API issues a HTTP PUT request.</p>
</div>

  
</div>


<div class="sect2">
  <h3 id="remove">Remove object</h3>
  
<div class="paragraph">
    
  <p>The AGPipe also contains a <em>remove</em> method to delete the object on the server. As in the case of <em>update</em>, ensure that the <a href="#noteid">recordId</a> property is set, so that it knows which resource to delete.</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// Now, just remove the project:
[projects remove:projectEntity success:^(id responseObject) {
    // LOG the JSON response, returned from the server:
    NSLog(@"DELETE RESPONSE\n%@", [responseObject description]);
} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"DELETE: An error occured! \n%@", error);
}];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>In this case, where we have a RESTful pipe the API issues a HTTP DELETE request.</p>
</div>

  
</div>


  </div>
  
</div>


<div class="sect1">
  <h2 id="_time_out_and_cancel_pending_operations">Time out and Cancel pending operations</h2>
  
  <div class="sectionbody">

<div class="sect2">
  <h3 id="_timeout">Timeout</h3>
  
<div class="paragraph">
    
  <p>During construction of the Pipe object, you can optionally specify a timeout interval (default is 60 secs) for an operation to complete. If the time interval is exceeded with no response from the server, then the <em>failure</em> callback is executed.</p>
</div>
<div class="paragraph">
    
  <p>From the todo example above:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">id&lt;AGPipe&gt; projects = [todo pipe:^(id&lt;AGPipeConfig&gt; config) {
    ...
    [config setTimeout:20];  // set the time interval to 20 secs
}];</code></pre>
    
  </div>
</div>

  
</div>


<div class="sect2">
  <h3 id="_cancel">Cancel</h3>
  
<div class="paragraph">
    
  <p>At any time after starting your operations, you can call <em>cancel</em> on the Pipe object to cancel all running Pipe operations. Any registered callbacks on the pipe are NOT executed so it is your responsibility to provide any neccessary cleanups after calling this method.</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">[projects read:^(id responseObject) {
    // LOG the JSON response, returned from the server:
    NSLog(@"READ RESPONSE\n%@", [responseObject description]);
} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"Read: An error occured! \n%@", error);
}];

// cancel operations. NOTE that no 'success' or 'failure' callbacks are executed after this.
[projects cancel];</code></pre>
    
  </div>
</div>

  
</div>


  </div>
  
</div>


<div class="sect1">
  <h2 id="__a_id_paging_a_paging"><a id="paging"></a>Paging</h2>
  
  <div class="sectionbody">
<div class="paragraph">
    
  <p>The library has built-in paging support, enabling the scrolling to either forward or backwards through a result set returned from the server. Paging metadata located in the server response (either in the headers via <a href="http://tools.ietf.org/html/rfc5988">WebLinking RFC</a> or custom headers, or in the body) are used to identify the next or the previous result set. For example, the Twitter search paging metadata is located in the <a href="https://dev.twitter.com/docs/api/1/get/search">body</a> of the response signifying the next or previous result set. The location of this metadata as well as naming, is fully configurable during the creation of the pipe, thus enabling greater flexibility in supporting several different paging strategies.</p>
</div>
<div class="paragraph">
    
  <p>Below is an example that goes against the AeroGear Controller Server.</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">NSURL* baseURL = [NSURL URLWithString:@"https://controller-aerogear.rhcloud.com/aerogear-controller-demo"];
AGPipeline* agPipeline = [AGPipeline pipelineWithBaseURL:baseURL];

id&lt;AGPipe&gt; cars = [agPipeline pipe:^(id&lt;AGPipeConfig&gt; config) {
    [config setName:@"cars-custom"];

    [config setPageConfig:^(id&lt;AGPageConfig&gt; pageConfig) {
        [pageConfig setNextIdentifier:@"AG-Links-Next"];
        [pageConfig setPreviousIdentifier:@"AG-Links-Previous"];
        [pageConfig setMetadataLocation:@"header"];
    }];
}];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>Paging configuration parameters are encapsulated in the AGPageConfig object. Similar to the way we set Pipe configuration params by means of a block, paging configuration params are set using [AGPipeConfig setPageConfig:] method passing a block with the desired paging paramaters. Notice that in our example, we explicitely declare the name of the paging identifiers supported by the server, as well as the location of these identifiers in the response. If the metadataLocation is not specified, the library will assume the server is using Web Linking pagination strategy and will default to it.</p>
</div>
<div class="paragraph">
    
  <p>For cases that a custom pagination strategy is followed in the server application , the library also allows the user to plug in a user-defined one, by the means of the [pageConfig setPageParameterExtractor] configuration setting. If set, the library will follow this strategy, overriding the build-in provided ones. In that case, the metadata location is not required and is ignored if set. The strategy should follow the protocol AGPageParameterExtractor, allowing the library to determine the <em>next</em> and <em>previous</em> parameters.</p>
</div>

<div class="sect2">
  <h3 id="_start_paging">Start Paging</h3>
  
<div class="paragraph">
    
  <p>To kick-start pagination, you use the method <em>readWithParams</em> of the underlying AGPipe, passing your desired query parameters to the server. Upon successfully completion, the <em>pagedResultSet</em> (an enchached category of nsarray) will allow you to scroll through the result set.</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">__block NSMutableArray *pagedResultSet;

// fetch the first page
[cars readWithParams:@{@"color" : @"black", @"offset" : @"0", @"limit" : @1} success:^(id responseObject) {
    pagedResultSet = responseObject;

    // do something

} failure:^(NSError *error) {
    //handle error
}];</code></pre>
    
  </div>
</div>

  
</div>


<div class="sect2">
  <h3 id="_move_forward_in_the_result_set">Move Forward in the result set</h3>
  
<div class="paragraph">
    
  <p>To move forward in the result set, you simple call <em>next</em> on the <em>pagedResultSet</em> :</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// move to the next page
[pagedResultSet next:^(id responseObject) {
    // do something

} failure:^(NSError *error) {
    // handle error
}];</code></pre>
    
  </div>
</div>

  
</div>


<div class="sect2">
  <h3 id="_move_backwards_in_the_result_set">Move Backwards in the result set</h3>
  
<div class="paragraph">
    
  <p>To move backwards in the result set, you simple call <em>previous</em> on the <em>pagedResultSet</em> :</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">[pagedResultSet previous:^(id responseObject) {
    // do something

} failure:^(NSError *error) {
    // handle error
}];</code></pre>
    
  </div>
</div>
<div class="literalblock">
  
  <div class="content monospaced">
    <pre>## Notes</pre>
  </div>
</div>
<div class="literalblock">
  
  <div class="content monospaced">
    <pre>The library uses the 'next' and 'previous' identifiers:</pre>
  </div>
</div>
<div class="ulist">
  
  <ul>
  
    <li>
      <p>to extract the paging information params from the response and</p>
      
    </li>
  
    <li>
      <p>filling those paging information params in the subsequent ```next``` and ```previous``` requests.</p>
      
<div class="literalblock">
  
  <div class="content monospaced">
    <pre>Failing to provide correct identifiers, means that no paging params would be appended in the request. Caution: Without valid paging parameters the used service API may simply return the entire data. To ensure the results returned  do 'logical' represent a 'next' and 'previous' page, the user must ensure correct identifiers are set in the Page configuration.</pre>
  </div>
</div>
<div class="literalblock">
  
  <div class="content monospaced">
    <pre>Further, moving beyond last or first page is left on the behaviour of the specific server implementation, that is the library will not treat it differently. Some servers can throw an error (like Twitter or AeroGear Controller does) by respondng with an http error response, or simply return an empty list. The user is responsible to cater for exception cases like this.</pre>
  </div>
</div>

      
    </li>
  
  </ul>
</div>

  
</div>


  </div>
  
</div>


<div class="sect1">
  <h2 id="__a_id_store_a_store_and_datamanager"><a id="store"></a>Store and DataManager</h2>
  
  <div class="sectionbody">
<div class="paragraph">
    
  <p>A Store represents an abstraction layer for a storage system. Currently implemented storage systems are an <a href="http://aerogear.org/docs/specs/aerogear-ios/Classes/AGMemoryStorage.html">in-memory</a> and a <a href="http://aerogear.org/docs/specs/aerogear-ios/Classes/AGPropertyListStorage.html">property list</a> storage.</p>
</div>
<div class="paragraph">
    
  <p>A DataManager manages different Store implementations. It is basically a factory that hides the concrete instantiations of a specific Store implementation. The class offers simple APIs to add, remove or get access to a <em>data store</em>.</p>
</div>
<div class="admonitionblock">
  <table>
    <tr>
      <td class="icon">
        
        <div class="title">Note</div>
        
      </td>
      <td class="content">
        
        Right now, there is NO automatic data sync. This is up to the user.

      </td>
    </tr>
  </table>
</div>

<div class="sect2">
  <h3 id="_create_a_datamanager_with_store_object">Create a datamanager with store object:</h3>
  
<div class="paragraph">
    
  <p>After receiving data from the server, your application may want to keep the data around. The AGDataManager API allows you to create AGStore instances. To create a datamanager, you need to use the AGDataManager class. Below is an example:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// create the datamanager
AGDataManager* dm = [AGDataManager manager];
// add a new (default) store object:
id&lt;AGStore&gt; myStore = [dm store:^(id&lt;AGStoreConfig&gt; config) {
    [config setName:@"tasks"];
}];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>The AGDataManager class offers some simple <em>management</em> APIs to work with containing AGStore objects. The API offers read and write functionality. The default implementation represents an "in-memory" store. Similar to the pipe API technical details of the underlying system are not exposed.</p>
</div>

  
</div>


<div class="sect2">
  <h3 id="_save_data_to_the_store">Save data to the Store</h3>
  
<div class="paragraph">
    
  <p>When using a pipe to read all entries of a endpoint, you can use the AGStore to save the received objects:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">id&lt;AGPipe&gt; tasksPipe = [todo get:@"tasks"];

[tasksPipe read:^(id responseObject) {
    // the response object represents an NSArray,
    // containing multile 'Tasks' (as NSDictionary objects)

    // Save the response object to the store
    NSError *error;

    if (![myStore save:responseObject error:&amp;error])
        NSLog(@"Save: An error occured during save! \n%@", error);

} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"Read: An error occured! \n%@", error);
}];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>When loading all tasks from the server, the AGStore object is used inside of the <em>read</em> block from the AGPipe object. The returned collection of tasks is stored inside our in-memory store, from where the data can be accessed.</p>
</div>

  
</div>


<div class="sect2">
  <h3 id="_read_an_object_from_the_store">Read an object from the Store</h3>
  
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// read the task with the '0' ID:
id taskObject =  [myStore read:@"0"];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>The <em>read</em> function accepts the <em>recordID</em> of the object you want to retrieve. If the object does not exist in the store, <em>nil</em> is returned.</p>
</div>
<div class="paragraph">
    
  <p>If you want to read <em>all</em> the objects contained in the store, simply call the <em>readAll</em> function</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// read all objects from the store
NSArray *objects = [myStore readAll];</code></pre>
    
  </div>
</div>

  
</div>


<div class="sect2">
  <h3 id="_remove_one_object_from_the_store">Remove one object from the Store</h3>
  
<div class="paragraph">
    
  <p>The remove function allows you to delete a single entry in the collection, if present:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// remove the task with the '0' ID:
NSError *error;

if (![myStore remove:@"0" error:error])
    NSLog(@"Save: An error occured during remove! \n%@", error);</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>The remove method accepts the <em>recordID</em> of the object you want to remove. If the object does not exist in the store, FALSE is returned.</p>
</div>

  
</div>


<div class="sect2">
  <h3 id="_filter_the_entire_store">Filter the entire store</h3>
  
<div class="paragraph">
    
  <p>Filtering of the data available in the AGStore is also supported, by using the familiar NSPredicate class available in iOS. In the following example, after storing a pair of dictionaries representing user information details in the store (which can be easily come from a response from a server), we simple call the <em>filter</em> method to filter out the desired information:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c"> NSMutableDictionary *user1 = [@{@"id" : @"1",
                                @"name" : @"Robert",
                                @"city" : @"Boston",
                                @"department" : @{@"name" : @"Software", @"address" : @"Cornwell"},
                                @"experience" : @[@{@"language" : @"Java", @"level" : @"advanced"},
                                                  @{@"language" : @"C", @"level" : @"advanced"}]
                              } mutableCopy];

NSMutableDictionary *user2 = [@{@"id" : @"2",
                                @"name" : @"David",
                                @"city" : @"Boston",
                                @"department" : @{@"name" : @"Software", @"address" : @"Cornwell"},
                                @"experience" : @[@{@"language" : @"Java", @"level" : @"intermediate"},
                                                  @{@"language" : @"Python", @"level" : @"intermediate"}]
                              } mutableCopy];

NSMutableDictionary *user3 = [@{@"id" : @"3",
                                @"name" : @"Peter",
                                @"city" : @"Boston",
                                @"department" : @{@"name" : @"Software", @"address" : @"Branton"},
                                @"experience" : @[@{@"language" : @"Java", @"level" : @"advanced"},
                                                  @{@"language" : @"C", @"level" : @"intermediate"}]
                              } mutableCopy];

// save objects
BOOL success = [_memStore save:users error:nil];

if (success) { // if save succeeded, query the data
    NSPredicate *predicate = [NSPredicate
                              predicateWithFormat:@"city = 'Boston' AND department.name = 'Software' \
                              AND SUBQUERY(experience, $x, $x.language = 'Java' AND $x.level = 'advanced').@count &gt; 0" ];

    NSArray *results = [_memStore filter:predicate];

    // The array now contains the dictionaries _user1_ and _user_3, since they both satisfy the query predicate.
    // do something with the 'results'
    // ...
}</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>Using NSPredicate to filter desired data, is a powerful mechanism offered in iOS and we strongly suggest to familiarize yourself with it, if not already. Take a look at Apple&#8217;s own <a href="http://tinyurl.com/chmgwv5">documentation</a> for more information.</p>
</div>

  
</div>


<div class="sect2">
  <h3 id="_reset_the_entire_store">Reset the entire store</h3>
  
<div class="paragraph">
    
  <p>The reset function allows you the erase all data available in the used AGStore object:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// clears the entire store
NSError *error;

if (![myStore reset:&amp;error])
    NSLog(@"Reset: An error occured during reset! \n%@", error);</code></pre>
    
  </div>
</div>

  
</div>


<div class="sect2">
  <h3 id="_persistent_storage_system">Persistent Storage system</h3>
  
<div class="paragraph">
    
  <p>A simple <em>Property list</em> storage system is part of the library as well, The same <em>AGStore</em> protocol is used for reading and writing. Here is a quick example, that stores an <a href="http://en.wikipedia.org/wiki/One-time_password">One Time Password (OTP)</a> secret in the filesystem so that OTP tokens can be generated later (check AeroGear OTP iOS <a href="https://github.com/aerogear/aerogear-otp-ios">library</a> and <a href="https://github.com/aerogear/aerogear-otp-ios-demo">demo</a> for more information on OTP).</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// initalize plist store (if the file does not exist it will be created)
AGDataManager* manager = [AGDataManager manager];
id&lt;AGStore&gt; plistStore = [manager store:^(id&lt;AGStoreConfig&gt; config) {
    [config setName:@"secrets"]; // will be used as the filename for the plist
    [config setType:@"PLIST"];
}];

// the object to save (e.g. a dictionary)
NSDictionary *otp = [NSDictionary dictionaryWithObjectsAndKeys:@"19a01df0281afcdbe", @"otp", @"1", @"id", nil];

// save it
NSError *error;

if (![plistStore save:otp error:&amp;error])
    NSLog(@"Save: An error occured during save! \n%@", error);</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>The <em>read</em>, <em>reset</em> or <em>remove</em> API behave the same, as on the default ("in memory") store.</p>
</div>

  
</div>


  </div>
  
</div>


<div class="sect1">
  <h2 id="__a_id_auth_a_authentication_and_user_enrollment"><a id="auth"></a>Authentication and User enrollment</h2>
  
  <div class="sectionbody">
<div class="paragraph">
    
  <p>An Authenticator manages different authentication module implementations. It is basically a factory that hides the concrete instantiation of a specific Authentication Module implementation. The class offers simple APIs to add, remove, or get access to a <em>authentication module</em>.</p>
</div>
<div class="paragraph">
    
  <p>An AuthenticationModule represents an authentication module and provides the authentication and enrollment API. The default implementation uses REST as the auth transport. Similar to the Pipe, technical details of the underlying system are not exposed</p>
</div>

<div class="sect2">
  <h3 id="_creating_an_authenticator_with_an_authentication_module">Creating an authenticator with an authentication module</h3>
  
<div class="paragraph">
    
  <p>To create an authenticator, you need to use the AGAuthenticator class. Below is an example:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// create an authenticator object
AGAuthenticator* authenticator = [AGAuthenticator authenticator];

// add a new auth module and the required 'base url':
NSURL* baseURL = [NSURL URLWithString:@"https://todo-aerogear.rhcloud.com/todo-server/"];
id&lt;AGAuthenticationModule&gt; myMod = [authenticator auth:^(id&lt;AGAuthConfig&gt; config) {
    [config setName:@"authMod"];
    [config setBaseURL:baseURL];
}];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>The AGAuthenticator class offers some simple <em>management</em> APIs to work with containing AGAuthenticationModule objects. The API provides an authentication and enrollment API. The default implementation uses REST as the auth transport. Similar to the pipe API technical details of the underlying system are not exposed.</p>
</div>

  
</div>


<div class="sect2">
  <h3 id="_register_a_user">Register a user</h3>
  
<div class="paragraph">
    
  <p>The <em>enroll</em> function of the <em>AGAuthenticationModule</em> protocol is used to register new users with the backend:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// assemble the dictionary that has all the data for THIS particular user:
NSMutableDictionary* userData = [NSMutableDictionary dictionary];
[userData setValue:@"john" forKey:@"username"];
[userData setValue:@"123" forKey:@"password"];
[userData setValue:@"me@you.com" forKey:@"email"];
[userData setValue:@"21sda812sad24" forKey:@"betaAccountToken"];

// register a new user
[myMod enroll:userData success:^(id data) {
    // after a successful _registration_, we can work
    // with the returned data...
    NSLog(@"We got: %@", data);
} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"SAVE: An error occured! \n%@", error);
}];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>The <em>enroll</em> function submits a generic map object with contains all the information about the new user, that the server endpoint requires. The default (REST) auth module issues for the above a request against <em><a href="https://todo-aerogear.rhcloud.com/todo-server/auth/enroll">https://todo-aerogear.rhcloud.com/todo-server/auth/enroll</a></em>. Besides the NSDictionary the function accepts two simple blocks that are invoked on success or in case of a failure.</p>
</div>

  
</div>


<div class="sect2">
  <h3 id="_login">Login</h3>
  
<div class="paragraph">
    
  <p>Once you have a <em>valid</em> user you can use that information to issue a login against the server, to start accessing protected endpoints:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// issuing a login
[myMod login:@"john" password:@"123" success:^(id object) {
    // after a successful _login_, we can work
    // with the returned data...
} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"SAVE: An error occured! \n%@", error);
}];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>The default (REST) auth module issues for the above a request against <em><a href="https://todo-aerogear.rhcloud.com/todo-server/auth/login">https://todo-aerogear.rhcloud.com/todo-server/auth/login</a></em>. Besides the <em>username</em> and the <em>password</em>, the function accepts two simple blocks that are invoked on success or in case of a failure.</p>
</div>

  
</div>


<div class="sect2">
  <h3 id="_pass_the_auth_module_to_a_pipe">Pass the auth module to a pipe</h3>
  
<div class="paragraph">
    
  <p>After running a successful login, you can start using the <em>AGAuthenticationModule</em> object on a <em>AGPipe</em> object to access protected endpoints:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">id&lt;AGPipe&gt; tasks = [pipeline pipe:^(id&lt;AGPipeConfig&gt; config) {
    [config setName:@"tasks"];
    [config setBaseURL:serverURL];
    [config setAuthModule:myMod];
}];

[tasks read:^(id responseObject) {
    // LOG the JSON response, returned from the server:
    NSLog(@"READ RESPONSE\n%@", [responseObject description]);
} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"Read: An error occured! \n%@", error);
}];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>When creating a pipe you need to use the <em>authModule</em> argument in order to pass in an <em>AGAuthenticationModule</em> object.</p>
</div>

  
</div>


<div class="sect2">
  <h3 id="_logout">Logout</h3>
  
<div class="paragraph">
    
  <p>The logout from the server can be archived by using the <em>logout</em> function:</p>
</div>
<div class="listingblock">
  
  <div class="content monospaced">
    
    <pre class="highlight"><code class="c">// logout:
[myMod logout:^{
    // after a successful _logout_, when can notify the application
} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"SAVE: An error occured! \n%@", error);
}];</code></pre>
    
  </div>
</div>
<div class="paragraph">
    
  <p>The default (REST) auth module issues for the above a request against <em><a href="https://todo-aerogear.rhcloud.com/todo-server/auth/logout">https://todo-aerogear.rhcloud.com/todo-server/auth/logout</a></em>. The function accepts two simple blocks that are invoked on success or in case of a failure.</p>
</div>

  
</div>


<div class="sect2">
  <h3 id="_time_out_and_cancel_pending_operations_2">Time out and Cancel pending operations</h3>
  
<div class="paragraph">
    
  <p>As with the case of Pipe, configured timeout interval (in the config object) and cancel operation in <em>AGAuthenticationModule</em> is supported too.</p>
</div>

  
</div>


  </div>
  
</div>



</div>

            <div class="clearfix"></div>
      </div>
      <footer>
          <div class="wrapper">
              <div class="column">
                  <h3>News</h3>
                  
                  <p><a href="/news/2013/03/28/aerogear-1.0.0-is-out/index.html">AeroGear 1.0.0 is out!</a></p>
                  
                  <p><a href="/news/2013/03/04/aerogear-1.0.0.CR1-is-out/index.html">AeroGear 1.0.0.CR1 is out!</a></p>
                  
                  <p><a href="/news/2013/01/30/aerogear-1.0.0.M8-is-out/index.html">AeroGear 1.0.0.M8 is out!</a></p>
                  
                  <p><a href="/news/2012/12/20/aerogear-1.0.0.M7-is-out/index.html">AeroGear 1.0.0.M7 is out!</a></p>
                  
                  <p><a href="/news/2012/10/24/aerogear-1.0.0.M6-is-out/index.html">AeroGear 1.0.0.M6 is out!</a></p>
                  
              </div>
              <div class="column">
                  <h3>Get help</h3>
                  <p><a href="/docs">Documentation</a></p>
                  <p><a href="/examples">Examples</a></p>
              </div>
              <div class="column">
                  <h3>Contribute</h3>
                  <p><a href="http://github.com/aerogear" target="_blank">Source code</a></p>
                  <p><a href="http://issues.jboss.org/browse/AEROGEAR" target="_blank">Issue tracker</a></p>
                  <p><a href="https://lists.jboss.org/mailman/listinfo/aerogear-dev" target="_blank">Mailing list</a></p>
                  <p><a href="irc://irc.freenode.net/aerogear" target="_blank">IRC channel</a></p>
              </div>
              <div class="column responsive">
                  <h3>Social</h3>
                  <p><a href="">Twitter</a></p>
                  <p><a href="">Google Plus</a></p>
                  <p><a href="">Facebook</a></p>
              </div>
              <div class="column">
                  <h3><a href="http://twitter.com/AeroGears" target="_blank">@AeroGears</a></h3>
                  <div id="aerogear-twitter">Loading tweets...</div>
              </div>
              <div class="logos">
                  <p>AeroGear is a <a href="http://www.jboss.org/">JBoss Community</a> project<br class="title-break"> and its development is sponsored<br class="title-break"> by <a href="http://www.redhat.com/">Red Hat, Inc</a>.<br class="title-break"><br>Project code is released under <br class="title-break">the <a href="http://www.apache.org/licenses/LICENSE-2.0.html" target="_blank">Apache License, v2.0</a>.</p>
                  <p><a href="http://www.jboss.org/"><img src="/img/jboss_community.png" alt="JBoss Community"></a> <a href="http://www.redhat.com/"><img src="/img/red_hat.png" alt="Red Hat"></a></p>
                  <p>Copyright &copy; 2012, Red Hat, Inc.</p>
  <div class="clearfix"></div>
              </div>
          </div>
      </footer>
      <script src="/js/libs/repo-modified.js"></script>
      <script src="/js/libs/ba-linkify.min.js"></script>
      <script src="/js/libs/jquery.twitter.min.js"></script>
      <script src="/js/libs/jquery.smartresize.js"></script>
      <script src="/js/script.js"></script>
  </body>
</html>
